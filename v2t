#!/system/bin/sh
# V2T by Aditya Pratama :v
# Copyright (c) 2017 DEACE
version="1.1.09"

#Timelog
__time () {
	if [ $1 == 0 ]; then
		echo -n "[$(date +%H:%M:%S)] "
	else
		echo >> "$log"
		echo "[$(date '+%d-%m-%y %H:%M:%S')]" >> "$log"
	fi
}

## V2T FUNCTION ##

__print () {
	sleep 0.5
	echo "$1"
}

__tethering () {
	sleep 3
	__time 1
	iptables --flush &>> "$log"
	iptables -t filter -F FORWARD &>> "$log"
	iptables -t nat -F POSTROUTING &>> "$log"
	iptables -t filter -A FORWARD -j ACCEPT &>> "$log"
	iptables -t nat -A POSTROUTING -j MASQUERADE &>> "$log"
	__time 0
	echo "Mengatur DNS..."
	iptables -t nat -A PREROUTING -p udp --dport 53 -j DNAT --to "$dns" &>> "$log"
	ip rule add from "$ip/24" lookup 61 &>> "$log"
	ip route add default dev "$vpn" scope link table 61 &>> "$log"
	ip route add "$ip/24" dev "$interface" scope link table 61 &>> "$log"
	ip route add broadcast 255.255.255.255 dev "$interface" scope link table 61 &>> "$log"
	timelog
	echo "Selesai..."
}

## END V2T FUNCTION"


__print "
 __     ______ _____ 
 \ \   / /___ \_   _|	VPN TO TETHER v$version
  \ \ / /  __) || |  	Author: Aditya Pratama
   \ V /  / __/ | |  	Email: deace.inc@gmail.com
    \_/  |_____||_|  	facebook.com/deace.inc
                     
  Cara menggunakan: v2t [pintasan: -p ] [argumen] [isi] [...]
  -i  <interface> : Interface tethering. 
  -ia <ip address> : IP Address tethering.
  -c <config-file> : Lokasi konfigurasi (default: $HOME/v2t.conf.
  -p <wf/usb/bt> : Pintasan untuk tethering.
	-l <enable/disable> : Pencatatan log eksternal (default: disables)
	-a <enable/disable> : Otomatis mengulangi (default: enabled)
	-d <dns> : alamat DNS.
"